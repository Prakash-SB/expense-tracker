<!DOCTYPE html>
<html lang="en">
  
<head>
  <link rel="icon" type="image/svg+xml" href="https://raw.githubusercontent.com/Prakash-SB/expense-tracker/9ee4f87e9bd9ba753a314f373209f2bb44e71344/compressed_054c46e219b98b566cd4cb22af8c348e.svg">
<meta charset="UTF-8">
<meta name="viewport" content="width=1024">
<title> "Expense Tracker (Multi-User)"
</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>

<style>
  html {
    scroll-behavior: smooth;
  }
  body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  padding: 0;
  background: url('./images.svg') no-repeat center center fixed;
  background-size: cover;
  color: #f5f5f5;
  text-align: center;
  margin-top: 100px;
}

  header {
    background: #1f1f1f;
    color: #f5f5f5;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(0,0,0,0.6);
  }
  
  nav {
    display: flex;
    justify-content: center;
    background: #2a2a2a;
    padding: 10px;
    position: sticky;
    top: 0;
    z-index: 100;
    flex-wrap: wrap;
  }
  nav a {
    color: #f5f5f5;
    margin: 5px 10px;
    text-decoration: none;
    font-weight: 500;
    padding: 8px 12px;
    background: #333;
    border-radius: 6px;
    transition: color 0.3s ease, background 0.3s ease;
    cursor: pointer;
  }
  nav a:hover { color: #FFD700; background: #444; }

  section { padding: 30px 20px; max-width: 1200px; margin: auto; }
  .hidden { display: none; }

  /* LOGIN SCREEN */
  #login-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background: #121212;
  }
  #login-box {
    background: #1f1f1f;
    padding: 30px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.7);
  }
  #login-box input {
    padding: 10px;
    margin: 10px;
    width: 220px;
    border-radius: 5px;
    border: 1px solid #333;
    background: #2a2a2a;
    color: white;
  }
  #login-box button {
    padding: 12px 18px;
    margin: 5px;
    min-height: 44px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    background: #4a90e2;
    color: white;
    cursor: pointer;
  }
  #login-box button:hover { background: #357ABD; }

  /* Balance Box */
  .balance {
    text-align: center;
    background: #1e1e1e;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.7);
    font-size: 18px;
    font-weight: bold;
  }

  /* Form */
  .form-section {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
  }
  .form-section input, .form-section select {
    padding: 12px;
    flex: 1;
    min-width: 150px;
    border-radius: 5px;
    border: 1px solid #333;
    background: #2a2a2a;
    color: #fff;
    font-size: 16px;
  }
  .form-section button {
    background: #4a90e2;
    color: white;
    min-height: 44px;
    font-size: 16px;
    border: none;
    padding: 12px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .form-section button:hover { background: #357ABD; }

  /* Charts */
  .charts-wrapper {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: space-between;
  }
  .chart-container {
    background: #1e1e1e;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.7);
    flex: 1;
    min-width: 250px;
    max-width: 48%;
    height: 300px;
  }
  canvas { max-height: 250px; }

  /* Table */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    background: #1e1e1e;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.7);
  }
  table th, table td {
    padding: 12px;
    border-bottom: 1px solid #333;
    text-align: left;
  }
  table th { background: #2a2a2a; }
  table td button {
    padding: 5px 10px;
    border: none;
    min-height: 44px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    margin-right: 5px;
  }
  .delete-btn { background: #dc3545; color: white; }

  /* Calendar */
  #calendar-container {
    max-width: 900px;
    margin: auto;
  }

  /* PDF Button */
  #downloadPDF {
    background: #28a745;
    color: white;
    padding: 8px 11px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    margin: 1px auto 40px auto;
    display: block;
    font-size: 16px;
    min-height: 44px;
  }
  #downloadPDF:hover { background: #218838; }

  /* Admin Panel */
  #admin-panel {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 10px;
    margin: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.7);
  }
  #admin-panel h2 { margin-top: 0; }
  /* ‚úÖ Hamburger Menu Button */
#hamburger {
  display: none;
  font-size: 28px;
  cursor: pointer;
  padding: 10px 15px;
  color: #f5f5f5;
  position: absolute;
  left: 10px;
  top: 15px;
  background: #333;
  border-radius: 6px;
}

/* ‚úÖ Mobile Menu Styling */
@media (max-width: 768px) {
  .filter-grid {
    grid-template-columns: 1fr;
  }
  
  .filter-buttons {
    grid-column: 1;
  }
}
  #hamburger {
    display: block;
  }
  nav {
    display: none;
    flex-direction: column;
    background: #2a2a2a;
    position: absolute;
    top: 60px;
    left: 0;
    width: 100%;
    padding: 10px 0;
    z-index: 100;
  }
  nav.show {
    display: flex;
  }
  nav a {
    width: 100%;
    text-align: center;
    padding: 12px;
    border-bottom: 1px solid #444;
    font-size: 18px;
  }
}


  /* üì± MOBILE STYLING */
  /* ‚úÖ Mobile-friendly table */
@media (max-width: 768px) {
  nav {
    flex-direction: column;
    align-items: stretch;
  }
  nav a {
    width: 100%;
    text-align: center;
    margin: 4px 0;
  }

  /* Form fixes */
  .form-section { flex-direction: column; }
  .form-section input, .form-section select, .form-section button { width: 100%; }

  /* Charts stack */
  .charts-wrapper { flex-direction: column; }
  .chart-container { max-width: 100%; height: 280px; margin-bottom: 15px; }

  /* Better Card Layout for Transactions */
  table, thead, tbody, th, td, tr { display: block; width: 100%; }
  thead { display: none; }
  tr {
    background: #1e1e1e;
    margin-bottom: 15px;
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
  }
  td {
    padding: 8px 10px;
    border: none;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    font-size: 16px;
  }
  td::before {
    content: attr(data-label);
    font-weight: bold;
    color: #FFD700;
    margin-bottom: 4px;
  }
}

  /* TOAST NOTIFICATION */
.toast {
  visibility: hidden;
  min-width: 200px;
  background: #4caf50;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 12px;
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 16px;
  z-index: 999;
  opacity: 0;
  transition: opacity 0.5s, bottom 0.5s;
}
.toast.show {
  visibility: visible;
  opacity: 1;
  bottom: 100px;
}

/* üåô DARK MODE FULLCALENDAR FIX */
.fc-theme-standard td, 
.fc-theme-standard th {
  border: 1px solid #333 !important; /* Dark borders */
}

.fc .fc-toolbar-title {
  color: #fff !important; /* Title visible */
  font-weight: bold;
}

.fc .fc-daygrid-day-number {
  color: #fff !important; /* Day numbers visible */
}

.fc .fc-col-header-cell {
  background: #222 !important; /* Header background */
  color: #FFD700 !important; /* Header text (yellow) */
}

.fc-daygrid-day {
  background: #1e1e1e !important; /* Day cells dark */
  color: #fff !important;
}

.fc .fc-daygrid-day.fc-day-today {
  background: #333 !important; /* Highlight today's date */
  color: #FFD700 !important;
}

.fc-event {
  background-color: #28a745 !important; /* Income green */
  border: none !important;
  color: white !important;
  font-weight: bold;
  padding: 2px 4px;
  border-radius: 4px;
}
/* Calendar Event Styling */
.fc-event {
  opacity: 1 !important;
  border: none !important;
  padding: 2px 4px !important;
}

/* Income events (green) */
.income-event, .fc-event[style*="background-color: rgb(40, 167, 69)"] {
  background-color: #28a745 !important;
  border-color: #28a745 !important;
}

/* Expense events (red) */
.expense-event, .fc-event[style*="background-color: rgb(220, 53, 69)"] {
  background-color: #dc3545 !important;
  border-color: #dc3545 !important;
}

/* Ensure text is white */
.fc-event, .fc-event .fc-event-title {
  color: white !important;
}
#dropdownMenu p:hover {
  background: #444;
  border-radius: 5px;
}


</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div id="login-box">
    <h2>üîê Expense Tracker Login</h2>
    <input type="text" id="username" placeholder="Enter Username"><br>
    <input type="password" id="password" placeholder="Enter Password"><br>
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
    <p id="login-message"></p>
  </div>
</div>
<style>
    body {
      font-family: 'Poppins', sans-serif;
      text-align: center;
      margin-top: 100px;
    }
    #clock {
      color: white !important;
      font-size: 2em;
      font-weight: bold;
      color: #333;
    }
    .bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  display: flex;
  background: #1f1f1f;
  justify-content: space-around;
  padding: 10px 0;
  border-top: 1px solid #333;
}
.bottom-nav button {
  background: none;
  border: none;
  color: white;
  font-size: 16px;
  flex: 1;
  cursor: pointer;
}
.bottom-nav button:hover { color: #FFD700; }
.filter-section {
  background: #1e1e1e;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
  width: 100%;
}

.filter-section h3 {
  margin-top: 0;
  color: #FFD700;
}

.filter-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  align-items: end;
}

.filter-group {
  margin-bottom: 0;
}

.filter-group label {
  display: block;
  margin-bottom: 5px;
  color: #f5f5f5;
}

.filter-group input,
.filter-group select {
  width: 100%;
  padding: 8px;
  border-radius: 5px;
  background: #2a2a2a;
  border: 1px solid #333;
  color: white;
}

.filter-buttons {
  display: flex;
  gap: 10px;
  align-self: end;
}

.filter-buttons button {
  padding: 8px 15px;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  flex: 1;
}

#applyFilters {
  background: #4a90e2;
}

#resetFilters {
  background: #6c757d;
}
.logo{
  border;
  border-radius:10px;
  border:solid;
}
  </style>
</head>
<body>

  <h2> Current Date & Time</h2>
  <div id="clock"></div>

  <script>
    function updateClock() {
    
      let now = new Date();

      // Get date parts
      let day = String(now.getDate()).padStart(2, '0');
      let month = String(now.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed
      let year = now.getFullYear();

      // Get time parts
      let hours = String(now.getHours()).padStart(2, '0');
      let minutes = String(now.getMinutes()).padStart(2, '0');
      let seconds = String(now.getSeconds()).padStart(2, '0');

      // Format date and time
      let date = `${day}-${month}-${year}`;
      let time = `${hours}:${minutes}:${seconds}`;

      // Display in #clock div
      document.getElementById('clock').innerHTML = `${date} | ${time}`;
    }

    // Update every second
    setInterval(updateClock, 1000);

    // Call immediately to avoid 1-second delay
    updateClock();
  </script>
<!-- MAIN APP -->
<div id="app" class="hidden">
<header>
   <img class ="logo" src="https://raw.githubusercontent.com/Prakash-SB/expense-tracker/9ee4f87e9bd9ba753a314f373209f2bb44e71344/compressed_054c46e219b98b566cd4cb22af8c348e.svg" alt="Expense Tracker Logo" style="height:100px; vertical-align: middle;">
  <span style="font-size: 40px; font-weight: 100;">Expense Tracker</span>
  <div id="userMenu" style="position: relative; display: inline-block;">
  <span id="usernameDisplay" 
        style="font-size: 18px; font-weight: bold; cursor: pointer; color: #FFD700;">
  </span>
  <div id="dropdownMenu" 
       style="display: none; position: absolute; right: 0; background: #2a2a2a; 
              border-radius: 8px; box-shadow: 0px 4px 10px rgba(0,0,0,0.3); 
              padding: 10px; min-width: 160px; z-index: 100;">
    <p onclick="changePassword()" style="margin: 0; padding: 8px; color: #fff; cursor: pointer;">üîê Change Password</p>
    <hr style="border: 0; border-top: 1px solid #444; margin: 5px 0;">
    <p onclick="logout()" style="margin: 0; padding: 8px; color: #ff4d4d; cursor: pointer;">üö™ Logout</p>
  </div>
</div>

</header>
<nav id="menu">
  <a onclick="scrollToSection('dashboard')">Dashboard</a>
  <a onclick="scrollToSection('transactions')">Transactions</a>
  <a onclick="scrollToSection('calendar-section')">Calendar</a>
  <a onclick="changePassword()">üîë Change Password</a>
  <a onclick="logout()">üö™ Logout</a>
</nav>

<!-- Admin Panel -->
<div id="admin-panel" class="hidden">
  <h2>üëë Admin Panel</h2>
  <table>
    <thead><tr><th>User</th><th>Actions</th></tr></thead>
    <tbody id="user-list"></tbody>
  </table>
</div>

<section id="dashboard">
  <div class="balance">
    üí≥ Balance in Account (Online): ‚Çπ<span id="accountBalance">0.00</span> <br>
    üíµ Balance in Purse (Cash): ‚Çπ<span id="purseBalance">0.00</span>
  </div>

  <div class="form-section">
    <input type="text" id="description" placeholder="Description">
    <input type="number" id="amount" placeholder="Amount">
    <input type="date" id="date">
    <select id="type">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    <select id="mode">
      <option value="Cash">Cash</option>
      <option value="Online">Online</option>
    </select>
    <button onclick="addTransaction()">Add</button>
  </div>
  <div id="usernameDisplay" style="
    position: absolute; 
    top: 15px; 
    right: 20px; 
    font-weight: bold; 
    color: #FFD700;
"></div>


  <div class="charts-wrapper">
    <div class="chart-container"><canvas id="expenseChart"></canvas></div>
    <div class="chart-container"><canvas id="pieChart"></canvas></div>
  </div>
  
</section>
<div style="max-width: 1000px; margin: auto;">  <!-- ‚úÖ common container -->

  <!-- ‚úÖ FILTER SECTION -->
  <div class="filter-section" 
       style="background: #1e1e1e; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
    <h3 style="margin-top: 0; color: #FFD700;">üîç Filter Transactions</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; align-items: end;">
      <div>
        <label style="display: block; margin-bottom: 5px; color: #f5f5f5;">From Date</label>
        <input type="date" id="filterFrom" style="width: 100%; padding: 8px; border-radius: 5px; background: #2a2a2a; border: 1px solid #333; color: white;">
      </div>
      <div>
        <label style="display: block; margin-bottom: 5px; color: #f5f5f5;">To Date</label>
        <input type="date" id="filterTo" style="width: 100%; padding: 8px; border-radius: 5px; background: #2a2a2a; border: 1px solid #333; color: white;">
      </div>
      <div>
        <label style="display: block; margin-bottom: 5px; color: #f5f5f5;">Description</label>
        <input type="text" id="filterDesc" placeholder="Search..." style="width: 100%; padding: 8px; border-radius: 5px; background: #2a2a2a; border: 1px solid #333; color: white;">
      </div>
      <div>
        <label style="display: block; margin-bottom: 5px; color: #f5f5f5;">Type</label>
        <select id="filterType" style="width: 100%; padding: 8px; border-radius: 5px; background: #2a2a2a; border: 1px solid #333; color: white;">
          <option value="">All Types</option>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
      </div>
      <div>
        <label style="display: block; margin-bottom: 5px; color: #f5f5f5;">Mode</label>
        <select id="filterMode" style="width: 100%; padding: 8px; border-radius: 5px; background: #2a2a2a; border: 1px solid #333; color: white;">
          <option value="">All Modes</option>
          <option value="Cash">Cash</option>
          <option value="Online">Online</option>
        </select>
      </div>
      <div style="display: flex; gap: 10px; align-self: end;">
        <button onclick="applyFilters()" style="padding: 8px 15px; background: #4a90e2; color: white; border: none; border-radius: 5px; cursor: pointer; flex: 1;">Apply</button>
        <button onclick="resetFilters()" style="padding: 8px 15px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; flex: 1;">Reset</button>
      </div>
    </div>
  </div>
<section id="transactions">
  <table id="transactionTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Amount</th>
        <th>Type</th>
        <th>Mode</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="calendar-section">
  <div id="calendar-container">
    <div id="calendar"></div>
  </div>
</section>

<button id="downloadPDF" onclick="downloadPDF()">üìÑ Download PDF Report</button>
</div>

<script>
let users = JSON.parse(localStorage.getItem('users')) || {};
let currentUser = localStorage.getItem('currentUser') || null;
let barChart, pieChart, calendar;

function saveUsers() {
  localStorage.setItem('users', JSON.stringify(users));
}

function scrollToSection(id) {
  document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
}

// ‚úÖ LOGIN & SIGNUP
function login() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const message = document.getElementById('login-message');

  if (!users[username]) {
    message.textContent = "‚ùå User not found. Please sign up.";
    return;
  }
  if (users[username].password !== password) {
    message.textContent = "‚ùå Incorrect password.";
    return;
  }

  currentUser = username;
  localStorage.setItem('currentUser', currentUser);
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').classList.remove('hidden');

  // ‚úÖ If ADMIN logs in ‚Üí show panel & render user list
  if (currentUser === 'admin') {
    document.getElementById('admin-panel').classList.remove('hidden');
    renderAdmin();
  }
  document.getElementById('usernameDisplay').textContent = `üë§ ${currentUser}`;

  renderAll();
}

function signup() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const message = document.getElementById('login-message');

  if (!username || !password) {
    message.textContent = "‚ö†Ô∏è Enter username and password.";
    return;
  }
  if (users[username]) {
    message.textContent = "‚ö†Ô∏è Username already exists. Try login.";
    return;
  }

  // ‚úÖ Add new user
  users[username] = { password, transactions: [] };
  saveUsers();

  // ‚úÖ IF ADMIN IS LOGGED IN ‚Üí refresh panel live
  if (currentUser === 'admin') {
    renderAdmin();
  }

  message.textContent = "‚úÖ Account created. Please login.";
}

function logout() {
  localStorage.removeItem('currentUser');
  location.reload();
}

// ‚úÖ ADMIN PANEL
function renderAdmin() {
  const tbody = document.getElementById('user-list');
  tbody.innerHTML = '';

  for (const user in users) {
    tbody.innerHTML += `
      <tr>
        <td>${user}</td>
        <td>
          <button onclick="resetPassword('${user}')">üîë Reset Password</button>
          <button onclick="deleteUser('${user}')">üóë Delete</button>
        </td>
      </tr>`;
  }
}

function resetPassword(user) {
  const newPass = prompt("Enter new password for " + user);
  if (newPass) {
    users[user].password = newPass;
    saveUsers();
    alert("‚úÖ Password reset for " + user);
    renderAdmin(); // ‚úÖ refresh panel
  }
}

function deleteUser(user) {
  if (confirm("Delete user " + user + "?")) {
    delete users[user];
    saveUsers();
    renderAdmin(); // ‚úÖ refresh panel
    if (user === currentUser) logout();
  }
}

// ‚úÖ PASSWORD CHANGE
function changePassword() {
  const oldPass = prompt("Enter current password:");
  if (oldPass !== users[currentUser].password) {
    alert("‚ùå Wrong password!");
    return;
  }
  const newPass = prompt("Enter new password:");
  if (newPass) {
    users[currentUser].password = newPass;
    saveUsers();
    alert("‚úÖ Password updated!");
  }
}

// ‚úÖ CORE FUNCTIONS
function getTransactions() {
  return users[currentUser]?.transactions || [];
}
function setTransactions(arr) {
  users[currentUser].transactions = arr;
  saveUsers();
}

function addTransaction() {
  const description = document.getElementById('description').value;
  const amount = parseFloat(document.getElementById('amount').value);
  const type = document.getElementById('type').value;
  const mode = document.getElementById('mode').value;
  const date = document.getElementById('date').value;

  if (!description || isNaN(amount) || !date) {
    alert("Please enter valid details!");
    return;
  }

  const tx = getTransactions();
  tx.push({ description, amount, type, mode, date });
  setTransactions(tx);
  renderAll();
  clearForm();
   showToast("‚úÖ Transaction Added!")
}

function deleteTransaction(index) {
  if (confirm("Delete this transaction?")) {
    const tx = getTransactions();
    tx.splice(index, 1);
    setTransactions(tx);
    renderAll();
    showToast("üóë Transaction Deleted!");
  }
}

function clearForm() {
  document.getElementById('description').value = '';
  document.getElementById('amount').value = '';
  document.getElementById('date').value = '';
  document.getElementById('type').value = 'income';
  document.getElementById('mode').value = 'Cash';
}

// ‚úÖ RENDER FUNCTIONS
function renderAll() {
  renderTable();
  calculateBalances();
  updateCharts();
  updateCalendar();
  if (currentUser === 'admin') renderAdmin();
}

function renderTable() {
  renderFilteredTable(getTransactions().sort((a,b)=> new Date(b.date) - new Date(a.date)));
  const tbody = document.querySelector('#transactionTable tbody');
  tbody.innerHTML = '';
  let tx = getTransactions();
  tx = tx.sort((a,b)=> new Date(b.date) - new Date(a.date));

  tx.forEach((t, index) => {
    tbody.innerHTML += `
      <tr>
        <td data-label="Date">${t.date}</td>
        <td data-label="Description">${t.description}</td>
        <td data-label="Amount">‚Çπ${t.amount.toFixed(2)}</td>
        <td data-label="Type" style="color:${t.type==='income'?'#28a745':'#dc3545'};">${t.type}</td>
        <td data-label="Mode">${t.mode}</td>
        <td data-label="Delete"><button class="delete-btn" onclick="deleteTransaction(${index})">üóë Delete</button></td>
      </tr>`;
  });
}

function calculateBalances() {
  let tx = getTransactions();
  let online = 0, cash = 0;
  tx.forEach(t => {
    if (t.mode === 'Online') online += (t.type === 'income' ? t.amount : -t.amount);
    else cash += (t.type === 'income' ? t.amount : -t.amount);
  });
  document.getElementById('accountBalance').textContent = online.toFixed(2);
  document.getElementById('purseBalance').textContent = cash.toFixed(2);
}

function updateCharts() {
  const tx = getTransactions();
  const weekDays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const incomeData = Array(7).fill(0);
  const expenseData = Array(7).fill(0);

  const today = new Date();
const currentWeekStart = new Date(today);
currentWeekStart.setDate(today.getDate() - today.getDay());

  tx.forEach(t=>{
    const d = new Date(t.date);
    const i = d.getDay();
    if (t.type==='income') incomeData[i]+=t.amount;
    else expenseData[i]+=t.amount;
  });

  if (barChart) barChart.destroy();
  if (pieChart) pieChart.destroy();

  barChart = new Chart(document.getElementById('expenseChart'), {
    type:'bar',
    data:{
      labels:weekDays,
      datasets:[
        {label:'Income',data:incomeData,backgroundColor:'#28a745'},
        {label:'Expense',data:expenseData,backgroundColor:'#dc3545'}
      ]
    },
    options:{responsive:true}
  });

  pieChart = new Chart(document.getElementById('pieChart'), {
    type:'pie',
    data:{
      labels:['Income','Expense'],
      datasets:[{data:[incomeData.reduce((a,b)=>a+b,0),expenseData.reduce((a,b)=>a+b,0)],backgroundColor:['#28a745','#dc3545']}]
    }
  });
}

function updateCalendar() {
  if (calendar) calendar.destroy();
  const tx = getTransactions();
  
  const events = tx.map(t => ({
    title: `${t.type==='income'?'+':'-'}‚Çπ${t.amount} (${t.description})`,
    start: t.date,
    backgroundColor: t.type==='income' ? '#28a745' : '#dc3545', // Green for income, red for expense
    borderColor: t.type==='income' ? '#28a745' : '#dc3545',    // Border matches background
    textColor: '#<ffffff>',                                     // White text
    display: 'block',                                         // Full display
    classNames: t.type==='income' ? 'income-event' : 'expense-event' // Additional class
  }));
  
  calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    events,
    eventDisplay: 'block',
    eventColor: '#378006',
    eventDidMount: function(info) {
      // Additional styling when event mounts
      info.el.style.borderRadius = '4px';
      info.el.style.fontWeight = 'bold';
    }
  });
  
  calendar.render();
}

// ‚úÖ PDF DOWNLOAD
async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  // Set document properties
  doc.setProperties({
    title: 'Expense Tracker Report',
    subject: 'Financial Report',
    author: 'Expense Tracker App',
    keywords: 'expense, income, report',
    creator: 'Expense Tracker'
  });

  // Add header
  doc.setFontSize(18);
  doc.setTextColor(40, 167, 69); // Green color
  doc.text('Expense Tracker Report', 105, 15, { align: 'center' });
  
  // Add current date
  doc.setFontSize(10);
  doc.setTextColor(100, 100, 100); // Gray color
  const today = new Date();
  doc.text(`Generated on: ${today.toLocaleDateString()}`, 105, 22, { align: 'center' });

  // Reset text color
  doc.setTextColor(0, 0, 0); // Black color

  // Add transactions table
  const tx = getTransactions().sort((a, b) => new Date(b.date) - new Date(a.date));
  let y = 35; // Starting Y position
  
  // Table header
  doc.setFontSize(12);
  doc.setFont(undefined, 'bold');
  doc.text('Date', 15, y);
  doc.text('Description', 45, y);
  doc.text('Amount', 120, y);
  doc.text('Type', 150, y);
  doc.text('Mode', 180, y);
  y += 7;

  // Horizontal line
  doc.setDrawColor(200, 200, 200);
  doc.line(15, y, 195, y);
  y += 10;

  // Table rows
  doc.setFont(undefined, 'normal');
  doc.setFontSize(10);
  
  tx.forEach((t, index) => {
    if (y > 270) { // Check if we need a new page
      doc.addPage();
      y = 20;
      // Add header to new page
      doc.setFontSize(10);
      doc.text('Expense Tracker Report (continued)', 105, 10, { align: 'center' });
      y += 15;
    }

    // Format amount with proper currency symbol
    const amount = `${t.amount.toFixed(2)}`;
    
    // Set color based on transaction type
    if (t.type === 'income') {
      doc.setTextColor(40, 167, 69); // Green for income
    } else {
      doc.setTextColor(220, 53, 69); // Red for expense
    }

    doc.text(`${index + 1}. ${t.date}`, 15, y);
    doc.text(t.description, 45, y);
    doc.text(amount, 120, y);
    doc.text(t.type, 150, y);
    doc.text(t.mode, 180, y);
    
    // Reset text color
    doc.setTextColor(0, 0, 0);
    y += 7;
  });

  // Add summary section
  y += 10;
  doc.setFontSize(12);
  doc.setFont(undefined, 'bold');
  doc.setTextColor(0, 0, 255);
  doc.text('Summary', 15, y);
  y += 7;
  
  // Calculate totals
  let online = 0, cash = 0;
  tx.forEach(t => {
    if (t.mode === 'Online') {
      online += (t.type === 'income' ? t.amount : -t.amount);
    } else {
      cash += (t.type === 'income' ? t.amount : -t.amount);
    }
  });

  // Add summary details
  doc.setFont(undefined, 'bold',);
  doc.text(`Account Balance (Online): ${online.toFixed(2)}`, 20, y);
  y += 7;
  doc.text(`Purse Balance (Cash): ${cash.toFixed(2)}`, 20, y);
  y += 10;

  // Add footer
  doc.setFontSize(8);
  doc.setTextColor(100, 100, 100);
  doc.text('Generated by Expense Tracker App', 105, 285, { align: 'center' });

  // Save the PDF
  doc.save('Expense_Report.pdf');
}

// ‚úÖ AUTO LOGIN
if(currentUser){
  document.getElementById('login-screen').style.display='none';
  document.getElementById('app').classList.remove('hidden');
  if(currentUser==='admin') document.getElementById('admin-panel').classList.remove('hidden');
  renderAll();
}
function showToast(message) {
  let toast = document.getElementById("toast");
  toast.innerText = message;
  toast.className = "toast show";
  setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2500);
}

function toggleMenu() {
  document.getElementById("menu").classList.toggle("show");
}

function applyFilters() {
  const fromDate = document.getElementById('filterFrom').value;
  const toDate = document.getElementById('filterTo').value;
  const desc = document.getElementById('filterDesc').value.toLowerCase();
  const type = document.getElementById('filterType').value;
  const mode = document.getElementById('filterMode').value;

  let tx = getTransactions();
  
  // Apply filters
  tx = tx.filter(t => {
    const dateMatch = (!fromDate || t.date >= fromDate) && (!toDate || t.date <= toDate);
    const descMatch = !desc || t.description.toLowerCase().includes(desc);
    const typeMatch = !type || t.type === type;
    const modeMatch = !mode || t.mode === mode;
    
    return dateMatch && descMatch && typeMatch && modeMatch;
  });

  renderFilteredTable(tx);
}

function resetFilters() {
  document.getElementById('filterFrom').value = '';
  document.getElementById('filterTo').value = '';
  document.getElementById('filterDesc').value = '';
  document.getElementById('filterType').value = '';
  document.getElementById('filterMode').value = '';
  renderTable(); // Show all transactions
}

function renderFilteredTable(filteredTx) {
  const tbody = document.querySelector('#transactionTable tbody');
  tbody.innerHTML = '';
  
  filteredTx.forEach((t, index) => {
    tbody.innerHTML += `
      <tr>
        <td data-label="Date">${t.date}</td>
        <td data-label="Description">${t.description}</td>
        <td data-label="Amount">‚Çπ${t.amount.toFixed(2)}</td>
        <td data-label="Type" style="color:${t.type==='income'?'#28a745':'#dc3545'};">${t.type}</td>
        <td data-label="Mode">${t.mode}</td>
        <td data-label="Delete"><button class="delete-btn" onclick="deleteTransaction(${index})">üóë Delete</button></td>
      </tr>`;
  });
}

 document.addEventListener("DOMContentLoaded", () => {
  const savedUser = localStorage.getItem('currentUser');
  const usernameDisplay = document.getElementById('usernameDisplay');
  const dropdownMenu = document.getElementById('dropdownMenu');

  if (savedUser) {
    usernameDisplay.textContent = `üë§ ${savedUser}`;
  }

  // üëâ Toggle dropdown when username is clicked
  usernameDisplay.addEventListener('click', () => {
    dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
  });

  // üëâ Hide dropdown if clicked outside
  document.addEventListener('click', (event) => {
    if (!event.target.closest('#userMenu')) {
      dropdownMenu.style.display = 'none';
    }
  });
});

// ‚úÖ Logout function
function logout() {
  localStorage.removeItem('currentUser');
  window.location.reload(); // Or redirect to login page
}

// ‚úÖ Change Password function
function changePassword() {
  const newPassword = prompt("Enter your new password:");
  if (newPassword) {
    const currentUser = localStorage.getItem('currentUser');
    if (currentUser && users[currentUser]) {
      users[currentUser].password = newPassword;
      alert("‚úÖ Password updated successfully!");
      localStorage.setItem('users', JSON.stringify(users)); // save back to localStorage
    }
  }
}


</script>

    <!-- ‚úÖ Toast Notification -->
<div id="toast" class="toast">‚úÖ Transaction Added!</div>

<div class="bottom-nav">
  <button onclick="scrollToSection('dashboard')">üè† Home</button>
  <button onclick="scrollToSection('transactions')">üìú Transactions</button>
  <button onclick="scrollToSection('calendar-section')">üìÖ Calendar</button>
  <button onclick="logout()">üö™ Logout</button>
</div>



</body>
</html>

